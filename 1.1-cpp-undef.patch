--- origsrc/util-macros-1.1.6/xorg-macros.m4.in	2008-03-05 13:51:14.000000000 -0600
+++ src/util-macros-1.1.6/xorg-macros.m4.in	2008-08-25 14:19:09.038604700 -0500
@@ -79,6 +79,10 @@
 	if test `${RAWCPP} -undef < conftest.$ac_ext | grep -c 'unix'` -eq 1 ; then
 		RAWCPPFLAGS=-undef
 		AC_MSG_RESULT([yes])
+	# with Cygwin's gcc-3.4, unix is still defined even with -undef
+	elif test `${RAWCPP} -undef -ansi < conftest.$ac_ext | grep -c 'unix'` -eq 1 ; then
+		RAWCPPFLAGS="-undef -ansi"
+		AC_MSG_RESULT([yes, with -ansi])
 	else
 		AC_MSG_ERROR([${RAWCPP} defines unix with or without -undef.  I don't know what to do.])
 	fi
